document.addEventListener("DOMContentLoaded",()=>{let c="David Wang";let f=1e3,a=250,v=250,t={"/":{fragment:"_content/home.html",documentTitle:c},"/projects":{fragment:"_content/projects.html",documentTitle:"Projects - "+c},"/writing":{fragment:"_content/writing.html",documentTitle:"Writing - "+c},"/index.html":{fragment:"_content/home.html",documentTitle:c}},u=document.getElementById("content");if(!u)return;let h=Array.from(document.querySelectorAll(".subtitle .menu a.item")),i=document.querySelector(".container > h1"),r=document.querySelector(".subtitle > span:first-child"),l=r?.closest(".subtitle"),e=document.querySelector("footer");var n=(t,n)=>{let i;return(...e)=>{clearTimeout(i),i=setTimeout(()=>t(...e),n)}};let m=e=>{if(!e)return"/";let t=e.split("?")[0].split("#")[0];return(t=1<(t=t.startsWith("/")?t:"/"+t).length&&t.endsWith("/")?t.slice(0,-1):t)||"/"},p=e=>(e||"").toLowerCase().trim().replace(/["'`~!@#$%^&*()=+\[\]{}|;:\\<>,.?/]+/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),o=e=>{var t=parseFloat(e.lineHeight);return Number.isFinite(t)?t:(t=parseFloat(e.fontSize),Number.isFinite(t)?1.2*t:16)},D=e=>{var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.cssText="position:fixed;top:0;left:0;width:1px;height:1px;padding:0;border:none;outline:none;opacity:0",document.body.appendChild(t),t.focus(),t.setSelectionRange(0,e.length);let n=!1;try{n=document.execCommand("copy")}catch(e){n=!1}return document.body.removeChild(t),n},b=(e,n)=>{let i=Object.fromEntries(e.map(e=>[e,!1])),r=Object.fromEntries(e.map(e=>[e,null])),l=()=>Object.values(i).some(Boolean);return{state:i,isEngaged:l,engage:e=>{clearTimeout(r[e]),i[e]=!0,n(l())},disengage:(e,t=!1)=>{clearTimeout(r[e]),t?(i[e]=!1,n(l())):r[e]=setTimeout(()=>{i[e]=!1,n(l())},a)},cancel:e=>clearTimeout(r[e])}},y=(e,t,n="hover")=>{let i=!1;e.addEventListener("mouseenter",()=>{i?i=!1:t.engage(n)}),e.addEventListener("mouseleave",()=>t.disengage(n)),e.addEventListener("touchstart",()=>{i=!0},{passive:!0})},w=(e,t,n="scroll",i="touch")=>{let r=!1;var l;e.addEventListener("scroll",()=>{t.engage(n),r&&i&&t.engage(i),t.disengage(n)},{passive:!0}),i&&(e.addEventListener("touchstart",()=>{t.cancel(i),r=!0},{passive:!0}),e.addEventListener("touchend",l=()=>{r=!1,t.disengage(i)}),e.addEventListener("touchcancel",l))};var s=(e=>{if(!e)return[];var t,n=[];let i=0;for(;e.hasAttribute("data-subtitle-"+i);){var r=(e.getAttribute("data-subtitle-"+i)||"").trim();r&&n.push(r),i++}return n.length||(t=(e.textContent||"").trim())&&n.push(t),n})(r);let g={title:i?.textContent.trim()||c,subtitle:r?.textContent.trim()||"",subtitleVariants:s},d=()=>{var e;return 0<g.subtitleVariants.length?[...g.subtitleVariants]:(e=(g.subtitle||"").trim())?[e]:[]},H=e=>{var t;return Array.isArray(e)?(t=e.map(e=>(e||"").trim()).filter(Boolean)).length?t:d():"string"==typeof e&&(t=e.trim())?[t]:d()},E=(t,n)=>{if(i&&(i.textContent=t||g.title,i.classList.add("loaded")),r){t=H(n);r.textContent=t[0]||g.subtitle||"";let e=0;for(;r.hasAttribute("data-subtitle-"+e);)r.removeAttribute("data-subtitle-"+e++);t.forEach((e,t)=>{r.setAttribute("data-subtitle-"+t,e)}),l?.classList.add("loaded")}e?.classList.add("loaded")},L=null,M=e=>{if(!e)return null;L||((L=document.createElement("span")).id="menu-measure",L.style.cssText="visibility:hidden;position:absolute;white-space:nowrap",document.body.appendChild(L));e=window.getComputedStyle(e);return L.style.fontSize=e.fontSize,L.style.fontFamily=e.fontFamily,L.style.fontWeight=e.fontWeight,L.style.fontStretch=e.fontStretch,L},O=e=>{if(e){var n=e.closest(".subtitle")||e.closest("footer");if(n){var i=M(e);if(i){var r=n.offsetWidth,l=(i.textContent="0",i.offsetWidth),a=(e.classList.remove("menu--stacked"),e.offsetWidth,e.querySelectorAll(".item, a"));let t=0;a.forEach(e=>t+=e.offsetWidth);var o=t+l*(a.length-1),s=n.classList.contains("subtitle")?n:null,d=s?.querySelector("span:first-child"),c=[];if(d){let e=0;for(;d.hasAttribute("data-subtitle-"+e);)c.push(d.getAttribute("data-subtitle-"+e++))}if(r<o)d&&0<c.length&&(d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")),e.classList.add("menu--stacked");else if(s&&d&&0<c.length){var u,h=4*l;for(u of c)if(i.textContent=u,i.offsetWidth+h+o<=r)return d.textContent=u,void s.classList.remove("subtitle--stacked");d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")}}}}},C=()=>{document.querySelectorAll(".menu").forEach(O)};s=n(C,10);C(),window.addEventListener("resize",s);let P=(d,c)=>{if(d&&c){let r=document.createElement("div"),l=(r.className="code-block__custom-scrollbar",r.innerHTML=`
            <div class="code-block__scrollbar-track">
                <div class="code-block__scrollbar-thumb"></div>
            </div>
        `,d.appendChild(r),r.querySelector(".code-block__scrollbar-track")),a=r.querySelector(".code-block__scrollbar-thumb");var e=()=>{var e,{scrollWidth:t,clientWidth:n,scrollLeft:i}=c;t<=n?r.style.display="none":(r.style.display="",e=n/t*l.offsetWidth,i=i/(t-n)*(l.offsetWidth-e),a.style.width=e+"px",a.style.left=i+"px")};c.addEventListener("scroll",e,{passive:!0}),e(),new ResizeObserver(e).observe(c);let i=!1,t=b(["hover","scroll","touch"],e=>{d.classList.toggle("code-block--scrollbar-visible",e||i)}),n=(y(d,t),w(c,t),null);a.addEventListener("pointerdown",e=>{i=!0,n=e.pointerId,a.setPointerCapture(e.pointerId),d.classList.add("code-block--scrollbar-visible"),e.preventDefault()});e=e=>{e.pointerId!==n||(i=!1,n=null,a.releasePointerCapture(e.pointerId),t.isEngaged())||d.classList.remove("code-block--scrollbar-visible")};a.addEventListener("pointerup",e),a.addEventListener("pointercancel",e);let o=0,s=0;a.addEventListener("pointerdown",e=>{o=e.clientX,s=c.scrollLeft}),a.addEventListener("pointermove",e=>{var t,n;i&&(e=e.clientX-o,t=c.scrollWidth-c.clientWidth,n=l.offsetWidth-a.offsetWidth,c.scrollLeft=s+e/n*t)}),l.addEventListener("click",e=>{var t;e.target!==a&&(t=l.getBoundingClientRect(),e=(e.clientX-t.left)/l.offsetWidth,c.scrollLeft=e*(c.scrollWidth-c.clientWidth))})}},R=(t,e,n)=>{if("true"===t.dataset.enhanced)return;t.dataset.enhanced="true";let i=(t.textContent||"code").trim().toLowerCase();var r=e.querySelector(".code-scroll");let l="idle",a=null,o=null,s={idle:i,ready:"copy",copied:"copied!",error:"error"},d=e=>{clearTimeout(a),t.textContent.toLowerCase()===e?t.style.opacity="1":(t.style.transition="opacity 0.08s ease",t.style.opacity="0",a=setTimeout(()=>{t.textContent=e,t.style.transition="opacity 0.17s ease",t.style.opacity="1"},80))},c=e=>{l!==e&&(l=e,d(s[e]||i))};let u=b(["hover","scroll","touch","longpress"],e=>{"copied"!==l&&"error"!==l&&c(e?"ready":"idle")}),h=(y(e,u),r&&w(r,u),e.addEventListener("contextmenu",e=>{e.preventDefault()}),null),m=!1,p=(e.addEventListener("touchstart",e=>{m=!0,clearTimeout(h),h=setTimeout(()=>{u.engage("longpress")},v)},{passive:!0}),e.addEventListener("touchmove",()=>{clearTimeout(h)},{passive:!0}),e.addEventListener("touchend",e=>{clearTimeout(h),0===e.touches.length&&(m=!1,"copied"!==l)&&"error"!==l&&u.disengage("longpress")}),e.addEventListener("touchcancel",e=>{clearTimeout(h),0===e.touches.length&&(m=!1,u.disengage("longpress",!0))}),()=>{var e=n.innerText||n.textContent||"";if(!e)return g(!1,"no text");e=D(e);g(e,e?null:"execCommand failed")}),g=(e,t=null)=>{clearTimeout(o),e?c("copied"):(d(t?"err: "+t:"error"),l="error");t=e?f:3e3;o=setTimeout(()=>{m||u.disengage("longpress",!0),c(u.isEngaged()?"ready":"idle")},t)};t.addEventListener("touchend",e=>{e.preventDefault(),p()}),t.addEventListener("click",e=>{e.preventDefault(),p()})},V=(e,t)=>{if(!e)return null;var n=(e.getAttribute("id")||"").trim();if(n)return n;let i=t||"section",r=2;for(;document.getElementById(i);)i=`${t||"section"}-`+r++;return e.setAttribute("id",i),i},S=(e,t)=>{e=e.querySelector("[data-toc]");if(e){let l=[];var n=i?V(i,"introduction"):null;if(n&&l.push({level:1,id:n,label:"Introduction"}),t.forEach(t=>{var n=parseInt((t.tagName||"").slice(1),10);if(!(!t.id||isNaN(n)||n<2||3<n)){let e=t.dataset.headingLabel;e||(e=(t.textContent||"").trim().replace(/^#\s*/,""),t.dataset.headingLabel=e),l.push({level:n,id:t.id,label:e})}}),l.length){e.classList.remove("is-empty");let i=document.createElement("ol"),r=(i.className="writing-toc__list",e.innerHTML="",e.appendChild(i),null);l.forEach(e=>{var t=document.createElement("li"),n=(t.className="writing-toc__item writing-toc__item--level-"+e.level,document.createElement("a"));if(n.href="#"+e.id,n.textContent=e.label,t.appendChild(n),e.level<=2)i.appendChild(t),r=2===e.level?t:null;else if(3===e.level)if(r){let e=r.querySelector("ol");e||((e=document.createElement("ol")).className="writing-toc__sublist",r.appendChild(e)),e.appendChild(t)}else i.appendChild(t),r=t})}else e.innerHTML="",e.classList.add("is-empty")}},T=(e=document)=>{let a=e.querySelector(".writing-post__rail-right");e=e.querySelector(".writing-post__content");if(a&&e){var t=a.querySelector(".sidenote--rail");if(!t||"none"!==window.getComputedStyle(t).display){t=Array.from(e.querySelectorAll("label.sidenote-number"));if(t.length){let r=e.getBoundingClientRect(),l=[];t.forEach(e=>{var t,n,i=e.getAttribute("for");i&&(i=a.querySelector(`.sidenote--rail[data-sidenote-ref="${i}"]`))&&(t=e.parentElement)&&(n=t.getBoundingClientRect(),t=window.getComputedStyle(t),t=o(t),e=e.getBoundingClientRect(),e=Math.round((e.top-n.top)/t),n=n.top-r.top+e*t,l.push({sidenote:i,idealTop:n,height:0}))}),l.forEach((t,n)=>{t.sidenote.style.top=t.idealTop+"px",t.height=t.sidenote.getBoundingClientRect().height;var e=window.getComputedStyle(t.sidenote),i=.5*o(e);for(let e=0;e<n;e++){var r=l[e],r=(parseFloat(r.sidenote.style.top)||0)+r.height;(parseFloat(t.sidenote.style.top)||0)<r+i&&(t.sidenote.style.top=(r=r+i)+"px",t.idealTop=r)}})}}}};s=n(()=>T(document),10);window.addEventListener("resize",s);let A=null,x=!1,_=e=>e&&e instanceof Node&&(e=e.nodeType===Node.TEXT_NODE?e.parentNode:e)&&e instanceof Element&&(e.closest(".sidenote")||e.closest(".math-display")||e.closest("table")||e.closest(".writing-post__content"))||null,q=e=>{A!==e&&(A?.removeAttribute("data-selection-active"),(A=e||null)?(A.setAttribute("data-selection-active","true"),document.body.setAttribute("data-selection-lock","true")):document.body.removeAttribute("data-selection-lock"))},W=()=>{A?.removeAttribute("data-selection-active"),A=null,document.body.removeAttribute("data-selection-lock"),x=!1},k=(document.addEventListener("pointerdown",e=>{e=_(e.target);e?(q(e),x=!0):W()},{capture:!0}),document.addEventListener("pointerup",()=>{x=!1;var e=document.getSelection?.();e&&!e.isCollapsed||W()}),document.addEventListener("pointercancel",W),window.addEventListener("blur",W),document.addEventListener("selectionchange",()=>{var e=document.getSelection?.();e&&!e.isCollapsed&&0!==e.rangeCount&&(e=_(e.anchorNode)||_(e.focusNode))?q(e):x||W()}),document.addEventListener("dragstart",e=>{if("IMG"===e.target.tagName)return e.preventDefault(),!1}),null),N=e=>{e=m(e);if(t[e])return t[e];if(e.startsWith("/writing/")&&e.length>"/writing/".length){e=e.slice("/writing/".length).replace(/\/+/g,"").replace(/\.html$/i,"");if(e)return{fragment:`_content/writing/${e}.html`,documentTitle:null,canonicalPath:"/writing/"+e}}return null},F=(e,t=!0)=>!!e&&!!(e=document.getElementById(e))&&(e.scrollIntoView({behavior:t?"smooth":"auto",block:"start",inline:"nearest"}),!0),B=async(t,n=!0)=>{var t=m(t),e=N(t);if(!e?.fragment)return console.error("No route found for: "+t),u.innerHTML="<p>Page not found.</p>",document.title="Not Found - "+c,E(g.title,g.subtitleVariants),null;var i,r,l,a=e.canonicalPath||t,o=e.fragment.startsWith("/")?e.fragment:"/"+e.fragment;try{var s,d=await fetch(o);if(d.ok)return s=await d.text(),u.style.opacity="0",l=150,await new Promise(e=>setTimeout(e,l)),u.innerHTML=s,W(),[r=document]=[u],r.querySelectorAll(".writing-post table").forEach(e=>{var t,n;e.parentElement?.classList.contains("table-wrapper")||((t=document.createElement("div")).className="table-wrapper",(n=document.createElement("div")).className="table-scroll",e.parentNode.insertBefore(t,e),n.appendChild(e),t.appendChild(n))}),[i=document]=[u],i.querySelectorAll(".code-block").forEach(e=>{var t,n,i;"true"!==e.dataset.enhanced&&(e.dataset.enhanced="true",t=e.querySelector(".code-scroll"),n=e.querySelector(".code-language-tag"),i=e.querySelector("pre")?.querySelector("code"),t&&P(e,t),n)&&i&&R(n,e,i)}),((e=document)=>{var t=e.querySelectorAll("h2, h3");if(t.length){let h=new Set(Array.from(document.querySelectorAll("[id]")).map(e=>e.id));t.forEach(i=>{let r=i.dataset.headingLabel;if(r||(r=(i.textContent||"section").trim().replace(/^#\s*/,""),i.dataset.headingLabel=r),"true"!==i.dataset.headingEnhanced){let n=(i.getAttribute("id")||"").trim();if(!n){var l=p(r)||"section";let e=l,t=2;for(;h.has(e);)e=l+"-"+t++;n=e,i.setAttribute("id",n),h.add(n)}if(!i.querySelector(".heading-anchor")){for(var e,t,a,o,s,d=document.createElement("a"),c=(d.className="heading-anchor",d.href="#"+n,d.textContent="#",[]),u=document.createTreeWalker(i,NodeFilter.SHOW_TEXT);e=u.nextNode();)e.textContent.trim()&&c.push(e);0<c.length&&(s=(o=(t=c[c.length-1]).textContent.trimEnd()).lastIndexOf(" "),a=o.slice(0,s+1),o=o.slice(s+1))?((s=document.createElement("span")).style.whiteSpace="nowrap",s.textContent=o,s.appendChild(d),t.textContent=a,t.parentNode.insertBefore(s,t.nextSibling)):i.appendChild(d)}i.dataset.headingEnhanced="true"}}),S(e,t),T(e)}else S(e,t)})(u),(t=>{var n=u.querySelector("[data-page-title]");if(n){var i,r=(n.getAttribute("data-page-title")||"").trim(),l=[];let e=0;for(;n.hasAttribute("data-page-subtitle-"+e);){var a=(n.getAttribute("data-page-subtitle-"+e++)||"").trim();a&&l.push(a)}l.length||(i=(n.getAttribute("data-page-subtitle")||"").trim())&&l.push(i),E(r||g.title,l.length?l:g.subtitleVariants),!t.documentTitle&&r&&(document.title=r+" - "+c),void C()}else t?.heading?E(t.heading.title,t.heading.subtitle):E(g.title,g.subtitleVariants),C()})(e),e.documentTitle&&(document.title=e.documentTitle),(e=>{e=m(e);let n=e.startsWith("/writing/")?"/writing":e;h.forEach(e=>{var t=m(e.getAttribute("href"));e.classList.toggle("active",t===n)})})(a),n&&(history.pushState({path:a,hash:null},document.title,a),window.scrollTo(0,0)),k=a,u.style.opacity="1",a;throw new Error("HTTP "+d.status)}catch(e){return(console.error("Error loading content:",e),t.startsWith("/writing/")&&"/writing"!==t)?(console.log("Writing page not found, redirecting to /writing"),B("/writing",n)):(u.innerHTML=`<p>Error loading page: ${e.message}</p>`,document.title="Error - "+c,E(g.title,g.subtitleVariants),u.style.opacity="1",null)}},I=(h.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=m(t.getAttribute("href"));e!==m(window.location.pathname)&&B(e)})}),u.addEventListener("click",e=>{var t=e.target.closest("a");if(t&&!(t.target&&"_self"!==t.target||t.hasAttribute("download")||"external"===t.getAttribute("rel"))){var n=t.getAttribute("href");if(n)if(n.startsWith("#")){n=n.slice(1);n&&(e.preventDefault(),i=m(window.location.pathname),history.pushState({path:i,hash:n},document.title,window.location.pathname+"#"+n),F(n))}else{var i=new URL(t.href,window.location.origin);if(i.origin===window.location.origin){let n=m(i.pathname);if(N(n)){e.preventDefault();let t=i.hash?i.hash.slice(1):null;B(n).then(e=>{t&&(e=e||n,history.replaceState({path:e,hash:t},document.title,e+"#"+t),F(t))})}}}}}),window.addEventListener("popstate",e=>{var t=e.state?.path||m(window.location.pathname);let n=e.state?.hash||(window.location.hash?window.location.hash.slice(1):null);t===k?n?F(n):window.scrollTo({top:0,behavior:"smooth"}):B(t,!1).then(()=>{n?requestAnimationFrame(()=>F(n)):window.scrollTo({top:0,behavior:"smooth"})})}),window.addEventListener("hashchange",()=>{let e=window.location.hash?window.location.hash.slice(1):null;e?requestAnimationFrame(()=>F(e)):window.scrollTo({top:0,behavior:"smooth"})}),m(window.location.pathname));if(N(I)){let t=window.location.hash?window.location.hash.slice(1):null;B(I,!1).then(e=>{e=e||m(I);history.replaceState({path:e,hash:t},document.title,t?e+"#"+t:e),t&&requestAnimationFrame(()=>F(t,!1))})}else B("/",!1).then(()=>{history.replaceState({path:"/",hash:null},c,"/")})});