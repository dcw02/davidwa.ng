document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("content");if(!e)return;let t="David Wang",l=Array.from(document.querySelectorAll(".subtitle .menu a.item")),i=document.querySelector(".container > h1"),n=document.querySelector(".subtitle > span:first-child"),a=e=>{if(!e)return;let t=e.closest(".subtitle")||e.closest("footer");if(!t)return;let l=document.getElementById("menu-measure");if(!l){(l=document.createElement("span")).id="menu-measure",l.style.visibility="hidden",l.style.position="absolute",l.style.whiteSpace="nowrap";let i=window.getComputedStyle(e);l.style.fontSize=i.fontSize,l.style.fontFamily=i.fontFamily,l.style.fontWeight=i.fontWeight,l.style.fontStretch=i.fontStretch,document.body.appendChild(l)}let n=t.offsetWidth;l.textContent="0";let a=l.offsetWidth;e.classList.remove("menu--stacked"),e.offsetWidth;let r=e.querySelectorAll(".item, a"),o=0;r.forEach(e=>{o+=e.offsetWidth});let s=o+a*(r.length-1),c=t.classList.contains("subtitle")?t:null,d=c?c.querySelector("span:first-child"):null,u=[];if(d){let h=0;for(;d.hasAttribute(`data-subtitle-${h}`);)u.push(d.getAttribute(`data-subtitle-${h}`)),h++}if(s>n){d&&u.length>0&&(d.textContent=u[u.length-1],c.classList.add("subtitle--stacked")),e.classList.add("menu--stacked");return}if(c&&d&&u.length>0){let m=4*a,p=null;for(let f of u){l.textContent=f;let g=l.offsetWidth,b=g+m+s;if(b<=n){p=f;break}}p?(d.textContent=p,c.classList.remove("subtitle--stacked")):(d.textContent=u[u.length-1],c.classList.add("subtitle--stacked"))}},r=()=>{document.querySelectorAll(".menu").forEach(a)},o,s=()=>{clearTimeout(o),o=setTimeout(r,10)};r(),window.addEventListener("resize",s);let c={title:i?i.textContent.trim():t,subtitle:n?n.textContent.trim():""},d={"/":{fragment:"_content/home.html",documentTitle:t},"/projects":{fragment:"_content/projects.html",documentTitle:`Projects - ${t}`},"/writing":{fragment:"_content/writing.html",documentTitle:`Writing - ${t}`},"/index.html":{fragment:"_content/home.html",documentTitle:t}},u=e=>new Promise(t=>setTimeout(t,e)),h=!1,m=!1,p=()=>new Promise((e,t)=>{if(h){e();return}if(m){let l=setInterval(()=>{h&&(clearInterval(l),e())},50);return}m=!0;let i=document.createElement("link");i.rel="stylesheet",i.href="https://unpkg.com/@catppuccin/highlightjs@1.0.1/css/catppuccin-mocha.css",document.head.appendChild(i);let n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js",n.onload=()=>{h=!0,m=!1,e()},n.onerror=()=>{m=!1,t(Error("Failed to load Highlight.js"))},document.body.appendChild(n)}),f=(e=document)=>{let t=e.querySelectorAll("pre code");t.length>0&&p().then(()=>{t.forEach(e=>{"undefined"!=typeof hljs&&hljs.highlightElement(e)})}).catch(e=>{console.error("Syntax highlighting unavailable:",e)});let l=e.querySelectorAll(".code-language-tag");l.forEach(e=>{if("true"===e.dataset.enhanced)return;let t=e.closest(".code-block"),l=t?t.querySelector("pre"):e.closest("pre"),i=l?l.querySelector("code"):null;if(!l||!i)return;let n=t||l,a=t?t.querySelector(".code-scroll"):null,r=()=>!!n&&n.matches(":hover"),o=(e=100)=>{if(t)t._hoverRemovalTimer&&(clearTimeout(t._hoverRemovalTimer),t._hoverRemovalTimer=null),!t.classList.contains("code-block--hover")&&(t._hoverAdditionTimer&&(clearTimeout(t._hoverAdditionTimer),t._hoverAdditionTimer=null),t._hoverAdditionTimer=setTimeout(()=>{t.classList.add("code-block--hover"),t._hoverAdditionTimer=null},e))},s=(e=900)=>{t&&(t._hoverAdditionTimer&&(clearTimeout(t._hoverAdditionTimer),t._hoverAdditionTimer=null),t._hoverRemovalTimer&&clearTimeout(t._hoverRemovalTimer),t._hoverRemovalTimer=setTimeout(()=>{if(t._hoverPointerActive||t._hoverFocusActive||r()){t._hoverRemovalTimer=null;return}t.classList.remove("code-block--hover"),t._hoverRemovalTimer=null},e))},c=e=>{t&&(t._hoverPointerActive=!!e,e&&o())},d=e=>{t&&(t._hoverFocusActive=!!e,e&&o())},u=()=>{e._labelAnimation&&(e._labelAnimation.fadeOutTimer&&clearTimeout(e._labelAnimation.fadeOutTimer),e._labelAnimation.fadeInTimer&&clearTimeout(e._labelAnimation.fadeInTimer),e._labelAnimation=null,e._pendingLabel=null,e.style.opacity="1")},h=(t,{immediate:l=!1}={})=>{let i=(t||"").toLowerCase();if(!i||!l&&(e._currentLabel===i||e._pendingLabel===i))return;let n=()=>{e.textContent=i,e._currentLabel=i,e._pendingLabel=null};if(l){u(),n(),e.style.opacity="1";return}u(),e._pendingLabel=i;e.style.opacity="0";let a=setTimeout(()=>{n(),e.style.opacity="1";let t=setTimeout(()=>{u()},220);e._labelAnimation={fadeOutTimer:a,fadeInTimer:t}},120);e._labelAnimation={fadeOutTimer:a,fadeInTimer:null}},m="copy",p=(e.textContent||"").trim().toLowerCase()||"code";e.dataset.originalLabel=p,e.dataset.enhanced="true",h(p,{immediate:!0}),e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-label",`Copy ${p} to clipboard`);let f=()=>{e.dataset.state="",t&&t._hoverPointerActive?h(m):h(e.dataset.originalLabel)},g=()=>{"copied"!==e.dataset.state&&"error"!==e.dataset.state&&h(m)},b=()=>{e.dataset.state="error",h("error"),e._copyTimer&&clearTimeout(e._copyTimer),e._copyTimer=setTimeout(f,1500)},v=()=>{e.dataset.state="copied",h("copied!"),e._copyTimer&&clearTimeout(e._copyTimer),e._copyTimer=setTimeout(f,1500)},y=async e=>{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;let t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select();let l=!1;try{l=document.execCommand("copy")}finally{document.body.removeChild(t)}return l},$=async()=>{let e=i.innerText||i.textContent||"";if(!e){b();return}try{let t=await y(e);t?v():b()}catch(l){console.error("Unable to copy code block:",l),b()}},E=()=>{c(!0),g()},L=()=>{if(c(!1),"copied"===e.dataset.state||"error"===e.dataset.state){s(0);return}h(e.dataset.originalLabel),s(0)};n&&(n.addEventListener("mouseenter",E),n.addEventListener("mouseleave",L),n.addEventListener("touchstart",E,{passive:!0}),n.addEventListener("touchend",L),n.addEventListener("touchcancel",L)),a&&a.addEventListener("scroll",()=>{let e=r();e?(c(!0),o(0),g()):t&&t._hoverFocusActive||s(0)},{passive:!0}),e.addEventListener("focus",()=>{d(!0),g()}),e.addEventListener("blur",()=>{if(d(!1),t&&t._hoverPointerActive)g();else{if("copied"===e.dataset.state||"error"===e.dataset.state){s(0);return}h(e.dataset.originalLabel),s(0)}}),e.addEventListener("click",e=>{e.preventDefault(),d(!0),g(),$()}),e.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),d(!0),g(),$())})})},g=e=>(e||"").toLowerCase().trim().replace(/["'`~!@#$%^&*()=+\[\]{}|;:\\<>,.?/]+/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),b=(e,t)=>{if(!e)return null;let l=(e.getAttribute("id")||"").trim();if(l)return l;let i=t||"section",n=2;for(;document.getElementById(i);)i=`${t||"section"}-${n++}`;return e.setAttribute("id",i),i},v=(e,t)=>{let l=e.querySelector("[data-toc]");if(!l)return;let i=[],n=document.querySelector(".container > h1"),a=n?b(n,"page-top"):null;if(a&&i.push({level:1,id:a,label:"Introduction"}),t.forEach(e=>{let t=parseInt((e.tagName||"").slice(1),10);if(!e.id||Number.isNaN(t)||t<2||t>3)return;let l=e.dataset.headingLabel;l||(l=(e.textContent||"").trim().replace(/^#\s*/,""),e.dataset.headingLabel=l),i.push({level:t,id:e.id,label:l})}),!i.length){l.innerHTML="",l.classList.add("is-empty");return}l.classList.remove("is-empty"),l.innerHTML="";let r=document.createElement("ol");r.className="writing-toc__list",l.appendChild(r);let o=null;i.forEach(e=>{if(1===e.level){let t=document.createElement("li");t.className="writing-toc__item writing-toc__item--level-1";let l=document.createElement("a");l.href=`#${e.id}`,l.textContent=e.label,t.appendChild(l),r.appendChild(t),o=null;return}if(2===e.level){let i=document.createElement("li");i.className="writing-toc__item writing-toc__item--level-2";let n=document.createElement("a");n.href=`#${e.id}`,n.textContent=e.label,i.appendChild(n),r.appendChild(i),o=i;return}if(3===e.level){if(!o){let a=document.createElement("li");a.className="writing-toc__item writing-toc__item--level-2";let s=document.createElement("a");s.href=`#${e.id}`,s.textContent=e.label,a.appendChild(s),r.appendChild(a),o=a;return}let c=o.querySelector("ol");c||((c=document.createElement("ol")).className="writing-toc__sublist",o.appendChild(c));let d=document.createElement("li");d.className="writing-toc__item writing-toc__item--level-3";let u=document.createElement("a");u.href=`#${e.id}`,u.textContent=e.label,d.appendChild(u),c.appendChild(d)}})},y=(e=document)=>{let t=e.querySelectorAll("h2, h3");if(!t.length){v(e,t);return}let l=new Set(Array.from(document.querySelectorAll("[id]")).map(e=>e.id));t.forEach(e=>{let t=e.dataset.headingLabel;if(t||(t=(e.textContent||"section").trim().replace(/^#\s*/,""),e.dataset.headingLabel=t),"true"===e.dataset.headingEnhanced)return;let i=(e.getAttribute("id")||"").trim(),n=i;if(!n){let a=g(t)||"section",r=a,o=2;for(;l.has(r);)r=`${a}-${o++}`;n=r,e.setAttribute("id",n),l.add(n)}let s=e.querySelector(".heading-anchor");if(!s){(s=document.createElement("a")).className="heading-anchor",s.href=`#${n}`,s.setAttribute("aria-label",`Link to section: ${t}`),s.textContent="#";let c=[],d=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),u;for(;u=d.nextNode();)u.textContent.trim()&&c.push(u);if(c.length>0){let h=c[c.length-1],m=h.textContent,p=m.trimEnd(),f=m.slice(p.length),b=p.lastIndexOf(" "),v=p.slice(0,b+1),y=p.slice(b+1);if(y){let $=document.createElement("span");$.style.whiteSpace="nowrap",$.textContent=y,$.appendChild(s),h.textContent=v+f,h.parentNode.insertBefore($,h.nextSibling)}else e.appendChild(s)}else e.appendChild(s)}e.dataset.headingEnhanced="true"}),v(e,t)},$=(e,{animate:t=!0}={})=>{if(!e)return!1;let l=document.getElementById(e);return!!l&&(l.scrollIntoView({behavior:t?"smooth":"auto",block:"start",inline:"nearest"}),!0)},E=null,L=!1,A=e=>{if(E!==e){if(E&&E.removeAttribute("data-selection-active"),!(E=e||null)){document.body.removeAttribute("data-selection-lock");return}E.setAttribute("data-selection-active","true"),document.body.setAttribute("data-selection-lock","true")}},T=()=>{E&&(E.removeAttribute("data-selection-active"),E=null),document.body.removeAttribute("data-selection-lock"),L=!1},_=e=>{if(!e||!(e instanceof Node)||(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!e||!(e instanceof Element)))return null;let t=e.closest(".sidenote");if(t)return t;let l=e.closest(".writing-post__content");return l||null};document.addEventListener("pointerdown",e=>{let t=_(e.target);t?(A(t),L=!0):T()},{capture:!0});let C=()=>{if(L=!1,!document.getSelection){T();return}let e=document.getSelection();(!e||e.isCollapsed)&&T()};document.addEventListener("pointerup",C),document.addEventListener("pointercancel",T),window.addEventListener("blur",T),document.addEventListener("selectionchange",()=>{let e=document.getSelection?document.getSelection():null;if(!e||e.isCollapsed||0===e.rangeCount){L||T();return}let t=_(e.anchorNode)||_(e.focusNode);t?A(t):L||T()});let w=e=>{if(!e)return"/";let t=e.split("?")[0].split("#")[0];return t.startsWith("/")||(t=`/${t}`),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t||"/"},x=e=>{let t=w(e);if(d[t])return d[t];if(t.startsWith("/writing/")&&t.length>9){let l=t.slice(9);if(!l)return null;let i=l.replace(/\/+/g,"").replace(/\.html$/i,"");return i?{fragment:`_content/writing/${i}.html`,documentTitle:null,canonicalPath:`/writing/${i}.html`}:null}return null},S=(e,t)=>{if(i&&(i.textContent=e||c.title,i.classList.add("loaded")),n){let l=[];l=void 0===t?[c.subtitle]:Array.isArray(t)?t.filter(e=>e):t?[t]:[c.subtitle],n.textContent=l[0]||c.subtitle;let a=0;for(;n.hasAttribute(`data-subtitle-${a}`);)n.removeAttribute(`data-subtitle-${a}`),a++;l.forEach((e,t)=>{n.setAttribute(`data-subtitle-${t}`,e)});let r=document.querySelector(".subtitle");r&&r.classList.add("loaded")}let o=document.querySelector("footer");o&&o.classList.add("loaded")},k=l=>{let i=e.querySelector("[data-page-title]");if(i){let n=(i.getAttribute("data-page-title")||"").trim(),a=[],o=0;for(;i.hasAttribute(`data-page-subtitle-${o}`);){let s=(i.getAttribute(`data-page-subtitle-${o}`)||"").trim();s&&a.push(s),o++}if(0===a.length){let d=(i.getAttribute("data-page-subtitle")||"").trim();d&&a.push(d)}S(n||c.title,a.length>0?a:c.subtitle),!l.documentTitle&&n&&(document.title=`${n} - ${t}`),r();return}if(l&&l.heading){let{title:u,subtitle:h}=l.heading;S(u,h),r();return}S(c.title,c.subtitle),r()},q=e=>{let t=w(e),i=t.startsWith("/writing/")?"/writing":t;l.forEach(e=>{let t=w(e.getAttribute("href"));t===i?e.classList.add("active"):e.classList.remove("active")})},N=async(l,i=!0)=>{let n=w(l),a=x(n);if(!a||!a.fragment)return console.error(`No route found for path: ${n}`),e.innerHTML="<p>Page not found.</p>",document.title=`Not Found - ${t}`,S(c.title,c.subtitle),null;let r=a.canonicalPath||n,o=a.fragment.startsWith("/")?a.fragment:`/${a.fragment}`;try{let s=await fetch(o);if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let d=await s.text();return e.style.opacity="0",await u(150),e.innerHTML=d,T(),f(e),y(e),k(a),a.documentTitle&&(document.title=a.documentTitle),q(r),i&&(history.pushState({path:r,hash:null},document.title,r),window.scrollTo(0,0)),e.style.opacity="1",r}catch(h){return console.error("Error loading content:",h),e.innerHTML=`<p>Error loading page: ${h.message}</p>`,document.title=`Error - ${t}`,S(c.title,c.subtitle),e.style.opacity="1",null}};l.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();let l=e.getAttribute("href"),i=w(l);i!==w(window.location.pathname)&&N(i)})});let W=()=>w(window.location.pathname);e.addEventListener("click",e=>{let t=e.target.closest("a");if(!t||t.target&&"_self"!==t.target||t.hasAttribute("download")||"external"===t.getAttribute("rel"))return;let l=t.getAttribute("href");if(!l)return;if(l.startsWith("#")){let i=l.slice(1);if(!i)return;e.preventDefault();let n=W();history.pushState({path:n,hash:i},document.title,`${window.location.pathname}#${i}`),$(i,{animate:!0});return}let a=new URL(t.href,window.location.origin);if(a.origin!==window.location.origin)return;let r=w(a.pathname),o=x(r);if(!o)return;e.preventDefault();let s=a.hash?a.hash.slice(1):null;N(r).then(e=>{if(s){let t=e||r;history.replaceState({path:t,hash:s},document.title,`${t}#${s}`),$(s,{animate:!0})}})}),window.addEventListener("popstate",e=>{let t=W(),l=e.state&&e.state.path?e.state.path:t,i=e.state&&"string"==typeof e.state.hash?e.state.hash:window.location.hash?window.location.hash.slice(1):null;if(l===t){i?$(i,{animate:!0}):window.scrollTo({top:0,behavior:"smooth"});return}N(l,!1).then(()=>{i?requestAnimationFrame(()=>{$(i,{animate:!0})}):window.scrollTo({top:0,behavior:"smooth"})})}),window.addEventListener("hashchange",()=>{let e=window.location.hash?window.location.hash.slice(1):null;e?requestAnimationFrame(()=>{$(e,{animate:!0})}):window.scrollTo({top:0,behavior:"smooth"})});let I=w(window.location.pathname),j=x(I);if(!j){q("/"),history.replaceState({path:"/",hash:null},t,"/");return}let P=window.location.hash?window.location.hash.slice(1):null;N(I,!1).then(e=>{let t=e||w(I);history.replaceState({path:t,hash:P},document.title,P?`${t}#${P}`:t),P&&requestAnimationFrame(()=>{$(P,{animate:!1})})})});
