document.addEventListener("DOMContentLoaded",()=>{let c="David Wang";let f=1500,t={"/":{fragment:"_content/home.html",documentTitle:c},"/projects":{fragment:"_content/projects.html",documentTitle:"Projects - "+c},"/writing":{fragment:"_content/writing.html",documentTitle:"Writing - "+c},"/index.html":{fragment:"_content/home.html",documentTitle:c}},u=document.getElementById("content");if(!u)return;let h=Array.from(document.querySelectorAll(".subtitle .menu a.item")),r=document.querySelector(".container > h1"),i=document.querySelector(".subtitle > span:first-child"),a=i?.closest(".subtitle"),e=document.querySelector("footer");var n=(t,n)=>{let r;return(...e)=>{clearTimeout(r),r=setTimeout(()=>t(...e),n)}};let m=e=>{if(!e)return"/";let t=e.split("?")[0].split("#")[0];return(t=1<(t=t.startsWith("/")?t:"/"+t).length&&t.endsWith("/")?t.slice(0,-1):t)||"/"},p=e=>(e||"").toLowerCase().trim().replace(/["'`~!@#$%^&*()=+\[\]{}|;:\\<>,.?/]+/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),l=e=>{var t=parseFloat(e.lineHeight);return Number.isFinite(t)?t:(t=parseFloat(e.fontSize),Number.isFinite(t)?1.2*t:16)},v=async e=>{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(e),!0;var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.cssText="position:absolute;left:-9999px",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}finally{document.body.removeChild(t)}};var o=(e=>{if(!e)return[];var t,n=[];let r=0;for(;e.hasAttribute("data-subtitle-"+r);){var i=(e.getAttribute("data-subtitle-"+r)||"").trim();i&&n.push(i),r++}return n.length||(t=(e.textContent||"").trim())&&n.push(t),n})(i);let g={title:r?.textContent.trim()||c,subtitle:i?.textContent.trim()||"",subtitleVariants:o},s=()=>{var e;return 0<g.subtitleVariants.length?[...g.subtitleVariants]:(e=(g.subtitle||"").trim())?[e]:[]},d=e=>{var t;return Array.isArray(e)?(t=e.map(e=>(e||"").trim()).filter(Boolean)).length?t:s():"string"==typeof e&&(t=e.trim())?[t]:s()},b=(t,n)=>{if(r&&(r.textContent=t||g.title,r.classList.add("loaded")),i){t=d(n);i.textContent=t[0]||g.subtitle||"";let e=0;for(;i.hasAttribute("data-subtitle-"+e);)i.removeAttribute("data-subtitle-"+e++);t.forEach((e,t)=>{i.setAttribute("data-subtitle-"+t,e)}),a?.classList.add("loaded")}e?.classList.add("loaded")},y=null,w=e=>{if(!e)return null;y||((y=document.createElement("span")).id="menu-measure",y.style.cssText="visibility:hidden;position:absolute;white-space:nowrap",document.body.appendChild(y));e=window.getComputedStyle(e);return y.style.fontSize=e.fontSize,y.style.fontFamily=e.fontFamily,y.style.fontWeight=e.fontWeight,y.style.fontStretch=e.fontStretch,y},E=e=>{if(e){var n=e.closest(".subtitle")||e.closest("footer");if(n){var r=w(e);if(r){var i=n.offsetWidth,a=(r.textContent="0",r.offsetWidth),o=(e.classList.remove("menu--stacked"),e.offsetWidth,e.querySelectorAll(".item, a"));let t=0;o.forEach(e=>t+=e.offsetWidth);var l=t+a*(o.length-1),s=n.classList.contains("subtitle")?n:null,d=s?.querySelector("span:first-child"),c=[];if(d){let e=0;for(;d.hasAttribute("data-subtitle-"+e);)c.push(d.getAttribute("data-subtitle-"+e++))}if(i<l)d&&0<c.length&&(d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")),e.classList.add("menu--stacked");else if(s&&d&&0<c.length){var u,h=4*a;for(u of c)if(r.textContent=u,r.offsetWidth+h+l<=i)return d.textContent=u,void s.classList.remove("subtitle--stacked");d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")}}}}},L=()=>{document.querySelectorAll(".menu").forEach(E)};o=n(L,10);L(),window.addEventListener("resize",o);let C=150,D=(c,u,h)=>{if(c&&u){let i=document.createElement("div"),a=(i.className="code-block__custom-scrollbar",i.innerHTML=`
            <div class="code-block__scrollbar-track">
                <div class="code-block__scrollbar-thumb"></div>
            </div>
        `,c.appendChild(i),i.querySelector(".code-block__scrollbar-track")),o=i.querySelector(".code-block__scrollbar-thumb");var m=()=>{var e,{scrollWidth:t,clientWidth:n,scrollLeft:r}=u;t<=n?i.style.display="none":(i.style.display="",e=n/t*a.offsetWidth,r=r/(t-n)*(a.offsetWidth-e),o.style.width=e+"px",o.style.left=r+"px")};u.addEventListener("scroll",m,{passive:!0}),m(),new ResizeObserver(m).observe(u);let r={hover:!1,touch:!1,scroll:!1,drag:!1},e=null,t=!1,n=()=>{var e=r.hover||r.touch||r.scroll||r.drag;c.classList.toggle("code-block--scrollbar-visible",e)};c.addEventListener("mouseenter",()=>{t?t=!1:(r.hover=!0,n())}),c.addEventListener("mouseleave",()=>{r.hover=!1,n()}),c.addEventListener("touchstart",e=>{h&&(e.target===h||h.contains(e.target))?t=!0:(r.touch=!0,n())},{passive:!0});m=()=>{r.touch=!1,n()};c.addEventListener("touchend",m),c.addEventListener("touchcancel",m),u.addEventListener("scroll",()=>{r.scroll=!0,n(),clearTimeout(e),e=setTimeout(()=>{r.scroll=!1,n()},C)},{passive:!0});let l=null;o.addEventListener("pointerdown",e=>{r.drag=!0,l=e.pointerId,o.setPointerCapture(e.pointerId),n(),e.preventDefault()});m=e=>{e.pointerId===l&&(r.drag=!1,l=null,o.releasePointerCapture(e.pointerId),n())};o.addEventListener("pointerup",m),o.addEventListener("pointercancel",m);let s=0,d=0;o.addEventListener("pointerdown",e=>{s=e.clientX,d=u.scrollLeft}),o.addEventListener("pointermove",e=>{var t,n;r.drag&&(e=e.clientX-s,t=u.scrollWidth-u.clientWidth,n=a.offsetWidth-o.offsetWidth,u.scrollLeft=d+e/n*t)}),a.addEventListener("click",e=>{var t;e.target!==o&&(t=a.getBoundingClientRect(),e=(e.clientX-t.left)/a.offsetWidth,u.scrollLeft=e*(u.scrollWidth-u.clientWidth))})}},H=(p,e,g)=>{if("true"!==p.dataset.enhanced){p.dataset.enhanced="true",p.tabIndex=p.tabIndex??0,p.setAttribute("role","button");let t=(p.textContent||"code").trim().toLowerCase(),n="idle",r={hover:!1,touch:!1,focus:!1},i=null,a=null,o=!1,l=()=>r.hover||r.touch||r.focus,s=e=>{let t=(e||"").toLowerCase();t&&p.textContent.toLowerCase()!==t&&(clearTimeout(a),p.style.transition="opacity 0.12s ease",p.style.opacity="0",a=setTimeout(()=>{p.textContent=t,p.style.transition="opacity 0.22s ease",p.style.opacity="1"},120))},d=e=>{switch(e){case"idle":return t;case"ready":return"copy";case"copied":return"copied!";case"error":return"error";default:return t}},c=e=>{n!==e&&(n=e,p.dataset.state=e,s(d(e)))},u=()=>{"copied"!==n&&"error"!==n&&c(l()?"ready":"idle")},h=e=>{clearTimeout(i),c(e?"copied":"error"),p.blur(),r.focus=!1,i=setTimeout(()=>{c(l()?"ready":"idle")},f)},m=async()=>{var e=g.innerText||g.textContent||"";if(e)try{h(await v(e))}catch(e){console.error("Copy failed:",e),h(!1)}else h(!1)};e.addEventListener("mouseenter",()=>{o?o=!1:(r.hover=!0,u())}),e.addEventListener("mouseleave",()=>{r.hover=!1,u()}),e.addEventListener("touchstart",e=>{e.target===p||p.contains(e.target)||(o=!0,r.touch=!0,u())},{passive:!0}),e.addEventListener("touchend",e=>{e.target===p||p.contains(e.target)||(r.touch=!1,u())}),e.addEventListener("touchcancel",e=>{e.target===p||p.contains(e.target)||(r.touch=!1,u())}),p.addEventListener("touchstart",()=>{o=!0,r.touch=!0,u()},{passive:!0}),p.addEventListener("touchend",e=>{r.touch=!1,("ready"===n?(e.preventDefault(),m):u)()}),p.addEventListener("touchcancel",()=>{r.touch=!1,u()}),p.addEventListener("focus",()=>{r.focus=!0,u()}),p.addEventListener("blur",()=>{r.focus=!1,u()}),p.addEventListener("click",e=>{e.preventDefault(),m()}),p.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),m())})}},M=(e,t)=>{if(!e)return null;var n=(e.getAttribute("id")||"").trim();if(n)return n;let r=t||"section",i=2;for(;document.getElementById(r);)r=`${t||"section"}-`+i++;return e.setAttribute("id",r),r},S=(e,t)=>{e=e.querySelector("[data-toc]");if(e){let a=[];var n=r?M(r,"introduction"):null;if(n&&a.push({level:1,id:n,label:"Introduction"}),t.forEach(t=>{var n=parseInt((t.tagName||"").slice(1),10);if(!(!t.id||isNaN(n)||n<2||3<n)){let e=t.dataset.headingLabel;e||(e=(t.textContent||"").trim().replace(/^#\s*/,""),t.dataset.headingLabel=e),a.push({level:n,id:t.id,label:e})}}),a.length){e.classList.remove("is-empty");let r=document.createElement("ol"),i=(r.className="writing-toc__list",e.innerHTML="",e.appendChild(r),null);a.forEach(e=>{var t=document.createElement("li"),n=(t.className="writing-toc__item writing-toc__item--level-"+e.level,document.createElement("a"));if(n.href="#"+e.id,n.textContent=e.label,t.appendChild(n),e.level<=2)r.appendChild(t),i=2===e.level?t:null;else if(3===e.level)if(i){let e=i.querySelector("ol");e||((e=document.createElement("ol")).className="writing-toc__sublist",i.appendChild(e)),e.appendChild(t)}else r.appendChild(t),i=t})}else e.innerHTML="",e.classList.add("is-empty")}},A=(e=document)=>{let o=e.querySelector(".writing-post__rail-right");e=e.querySelector(".writing-post__content");if(o&&e){var t=o.querySelector(".sidenote--rail");if(!t||"none"!==window.getComputedStyle(t).display){t=Array.from(e.querySelectorAll("label.sidenote-number"));if(t.length){let i=e.getBoundingClientRect(),a=[];t.forEach(e=>{var t,n,r=e.getAttribute("for");r&&(r=o.querySelector(`.sidenote--rail[data-sidenote-ref="${r}"]`))&&(t=e.parentElement)&&(n=t.getBoundingClientRect(),t=window.getComputedStyle(t),t=l(t),e=e.getBoundingClientRect(),e=Math.round((e.top-n.top)/t),n=n.top-i.top+e*t,a.push({sidenote:r,idealTop:n,height:0}))}),a.forEach((t,n)=>{t.sidenote.style.top=t.idealTop+"px",t.height=t.sidenote.getBoundingClientRect().height;var e=window.getComputedStyle(t.sidenote),r=.5*l(e);for(let e=0;e<n;e++){var i=a[e],i=(parseFloat(i.sidenote.style.top)||0)+i.height;(parseFloat(t.sidenote.style.top)||0)<i+r&&(t.sidenote.style.top=(i=i+r)+"px",t.idealTop=i)}})}}}};o=n(()=>A(document),10);window.addEventListener("resize",o);let T=null,x=!1,_=e=>e&&e instanceof Node&&(e=e.nodeType===Node.TEXT_NODE?e.parentNode:e)&&e instanceof Element&&(e.closest(".sidenote")||e.closest(".math-display")||e.closest("table")||e.closest(".writing-post__content"))||null,W=e=>{T!==e&&(T?.removeAttribute("data-selection-active"),(T=e||null)?(T.setAttribute("data-selection-active","true"),document.body.setAttribute("data-selection-lock","true")):document.body.removeAttribute("data-selection-lock"))},q=()=>{T?.removeAttribute("data-selection-active"),T=null,document.body.removeAttribute("data-selection-lock"),x=!1},k=(document.addEventListener("pointerdown",e=>{e=_(e.target);e?(W(e),x=!0):q()},{capture:!0}),document.addEventListener("pointerup",()=>{x=!1;var e=document.getSelection?.();e&&!e.isCollapsed||q()}),document.addEventListener("pointercancel",q),window.addEventListener("blur",q),document.addEventListener("selectionchange",()=>{var e=document.getSelection?.();e&&!e.isCollapsed&&0!==e.rangeCount&&(e=_(e.anchorNode)||_(e.focusNode))?W(e):x||q()}),document.addEventListener("dragstart",e=>{if("IMG"===e.target.tagName)return e.preventDefault(),!1}),null),N=e=>{e=m(e);if(t[e])return t[e];if(e.startsWith("/writing/")&&e.length>"/writing/".length){e=e.slice("/writing/".length).replace(/\/+/g,"").replace(/\.html$/i,"");if(e)return{fragment:`_content/writing/${e}.html`,documentTitle:null,canonicalPath:"/writing/"+e}}return null},I=(e,t=!0)=>!!e&&!!(e=document.getElementById(e))&&(e.scrollIntoView({behavior:t?"smooth":"auto",block:"start",inline:"nearest"}),!0),F=async(t,n=!0)=>{var t=m(t),e=N(t);if(!e?.fragment)return console.error("No route found for: "+t),u.innerHTML="<p>Page not found.</p>",document.title="Not Found - "+c,b(g.title,g.subtitleVariants),null;var r,i,a,o=e.canonicalPath||t,l=e.fragment.startsWith("/")?e.fragment:"/"+e.fragment;try{var s,d=await fetch(l);if(d.ok)return s=await d.text(),u.style.opacity="0",a=150,await new Promise(e=>setTimeout(e,a)),u.innerHTML=s,q(),[i=document]=[u],i.querySelectorAll(".writing-post table").forEach(e=>{var t,n;e.parentElement?.classList.contains("table-wrapper")||((t=document.createElement("div")).className="table-wrapper",(n=document.createElement("div")).className="table-scroll",e.parentNode.insertBefore(t,e),n.appendChild(e),t.appendChild(n))}),[r=document]=[u],r.querySelectorAll(".code-block").forEach(e=>{var t,n,r;"true"!==e.dataset.enhanced&&(e.dataset.enhanced="true",t=e.querySelector(".code-scroll"),n=e.querySelector(".code-language-tag"),r=e.querySelector("pre")?.querySelector("code"),t&&D(e,t,n),n)&&r&&H(n,e,r)}),((e=document)=>{var t=e.querySelectorAll("h2, h3");if(t.length){let h=new Set(Array.from(document.querySelectorAll("[id]")).map(e=>e.id));t.forEach(r=>{let i=r.dataset.headingLabel;if(i||(i=(r.textContent||"section").trim().replace(/^#\s*/,""),r.dataset.headingLabel=i),"true"!==r.dataset.headingEnhanced){let n=(r.getAttribute("id")||"").trim();if(!n){var a=p(i)||"section";let e=a,t=2;for(;h.has(e);)e=a+"-"+t++;n=e,r.setAttribute("id",n),h.add(n)}if(!r.querySelector(".heading-anchor")){for(var e,t,o,l,s,d=document.createElement("a"),c=(d.className="heading-anchor",d.href="#"+n,d.textContent="#",[]),u=document.createTreeWalker(r,NodeFilter.SHOW_TEXT);e=u.nextNode();)e.textContent.trim()&&c.push(e);0<c.length&&(s=(l=(t=c[c.length-1]).textContent.trimEnd()).lastIndexOf(" "),o=l.slice(0,s+1),l=l.slice(s+1))?((s=document.createElement("span")).style.whiteSpace="nowrap",s.textContent=l,s.appendChild(d),t.textContent=o,t.parentNode.insertBefore(s,t.nextSibling)):r.appendChild(d)}r.dataset.headingEnhanced="true"}}),S(e,t),A(e)}else S(e,t)})(u),(t=>{var n=u.querySelector("[data-page-title]");if(n){var r,i=(n.getAttribute("data-page-title")||"").trim(),a=[];let e=0;for(;n.hasAttribute("data-page-subtitle-"+e);){var o=(n.getAttribute("data-page-subtitle-"+e++)||"").trim();o&&a.push(o)}a.length||(r=(n.getAttribute("data-page-subtitle")||"").trim())&&a.push(r),b(i||g.title,a.length?a:g.subtitleVariants),!t.documentTitle&&i&&(document.title=i+" - "+c),void L()}else t?.heading?b(t.heading.title,t.heading.subtitle):b(g.title,g.subtitleVariants),L()})(e),e.documentTitle&&(document.title=e.documentTitle),(e=>{e=m(e);let n=e.startsWith("/writing/")?"/writing":e;h.forEach(e=>{var t=m(e.getAttribute("href"));e.classList.toggle("active",t===n)})})(o),n&&(history.pushState({path:o,hash:null},document.title,o),window.scrollTo(0,0)),k=o,u.style.opacity="1",o;throw new Error("HTTP "+d.status)}catch(e){return(console.error("Error loading content:",e),t.startsWith("/writing/")&&"/writing"!==t)?(console.log("Writing page not found, redirecting to /writing"),F("/writing",n)):(u.innerHTML=`<p>Error loading page: ${e.message}</p>`,document.title="Error - "+c,b(g.title,g.subtitleVariants),u.style.opacity="1",null)}},B=(h.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();e=m(t.getAttribute("href"));e!==m(window.location.pathname)&&F(e)})}),u.addEventListener("click",e=>{var t=e.target.closest("a");if(t&&!(t.target&&"_self"!==t.target||t.hasAttribute("download")||"external"===t.getAttribute("rel"))){var n=t.getAttribute("href");if(n)if(n.startsWith("#")){n=n.slice(1);n&&(e.preventDefault(),r=m(window.location.pathname),history.pushState({path:r,hash:n},document.title,window.location.pathname+"#"+n),I(n))}else{var r=new URL(t.href,window.location.origin);if(r.origin===window.location.origin){let n=m(r.pathname);if(N(n)){e.preventDefault();let t=r.hash?r.hash.slice(1):null;F(n).then(e=>{t&&(e=e||n,history.replaceState({path:e,hash:t},document.title,e+"#"+t),I(t))})}}}}}),window.addEventListener("popstate",e=>{var t=e.state?.path||m(window.location.pathname);let n=e.state?.hash||(window.location.hash?window.location.hash.slice(1):null);t===k?n?I(n):window.scrollTo({top:0,behavior:"smooth"}):F(t,!1).then(()=>{n?requestAnimationFrame(()=>I(n)):window.scrollTo({top:0,behavior:"smooth"})})}),window.addEventListener("hashchange",()=>{let e=window.location.hash?window.location.hash.slice(1):null;e?requestAnimationFrame(()=>I(e)):window.scrollTo({top:0,behavior:"smooth"})}),m(window.location.pathname));if(N(B)){let t=window.location.hash?window.location.hash.slice(1):null;F(B,!1).then(e=>{e=e||m(B);history.replaceState({path:e,hash:t},document.title,t?e+"#"+t:e),t&&requestAnimationFrame(()=>I(t,!1))})}else F("/",!1).then(()=>{history.replaceState({path:"/",hash:null},c,"/")})});