document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("content");if(!e)return;let t="David Wang",l=Array.from(document.querySelectorAll(".subtitle .menu a.item")),i=document.querySelector(".container > h1"),r=document.querySelector(".subtitle > span:first-child"),n=e=>{if(!e)return;let t=e.closest(".subtitle")||e.closest("footer");if(!t)return;let l=document.getElementById("menu-measure");if(!l){(l=document.createElement("span")).id="menu-measure",l.style.visibility="hidden",l.style.position="absolute",l.style.whiteSpace="nowrap";let i=window.getComputedStyle(e);l.style.fontSize=i.fontSize,l.style.fontFamily=i.fontFamily,l.style.fontWeight=i.fontWeight,l.style.fontStretch=i.fontStretch,document.body.appendChild(l)}let r=t.offsetWidth;l.textContent="0";let n=l.offsetWidth;e.classList.remove("menu--stacked"),e.offsetWidth;let a=e.querySelectorAll(".item, a"),o=0;a.forEach(e=>{o+=e.offsetWidth});let s=o+n*(a.length-1),c=t.classList.contains("subtitle")?t:null,d=c?c.querySelector("span:first-child"):null,u=[];if(d){let h=0;for(;d.hasAttribute(`data-subtitle-${h}`);)u.push(d.getAttribute(`data-subtitle-${h}`)),h++}if(s>r){d&&u.length>0&&(d.textContent=u[u.length-1],c.classList.add("subtitle--stacked")),e.classList.add("menu--stacked");return}if(c&&d&&u.length>0){let p=4*n,m=null;for(let f of u){l.textContent=f;let g=l.offsetWidth,b=g+p+s;if(b<=r){m=f;break}}m?(d.textContent=m,c.classList.remove("subtitle--stacked")):(d.textContent=u[u.length-1],c.classList.add("subtitle--stacked"))}},a=()=>{document.querySelectorAll(".menu").forEach(n)},o,s=()=>{clearTimeout(o),o=setTimeout(a,10)};a(),window.addEventListener("resize",s);let c={title:i?i.textContent.trim():t,subtitle:r?r.textContent.trim():""},d={"/":{fragment:"_content/home.html",documentTitle:t},"/projects":{fragment:"_content/projects.html",documentTitle:`Projects - ${t}`},"/writing":{fragment:"_content/writing.html",documentTitle:`Writing - ${t}`},"/index.html":{fragment:"_content/home.html",documentTitle:t}},u=e=>new Promise(t=>setTimeout(t,e)),h=!1,p=!1,m=()=>new Promise((e,t)=>{if(h){e();return}if(p){let l=setInterval(()=>{h&&(clearInterval(l),e())},50);return}p=!0;let i=document.createElement("link");i.rel="stylesheet",i.href="https://unpkg.com/@catppuccin/highlightjs@1.0.1/css/catppuccin-mocha.css",document.head.appendChild(i);let r=document.createElement("script");r.src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js",r.onload=()=>{h=!0,p=!1,e()},r.onerror=()=>{p=!1,t(Error("Failed to load Highlight.js"))},document.body.appendChild(r)}),f=(e,t)=>{if(!e||!t)return;let l=document.createElement("div");l.className="code-block__custom-scrollbar";let i=document.createElement("div");i.className="code-block__scrollbar-track";let r=document.createElement("div");r.className="code-block__scrollbar-thumb",i.appendChild(r),l.appendChild(i),e.appendChild(l);let n=()=>{let e=t.scrollWidth,n=t.clientWidth;if(e<=n){l.style.display="none";return}l.style.display="block";let a=n/e*i.offsetWidth,o=e-n,s=t.scrollLeft/o,c=i.offsetWidth-a,d=s*c;r.style.width=`${a}px`,r.style.left=`${d}px`};t.addEventListener("scroll",n,{passive:!0});let a=!1,o=0,s=0;r.addEventListener("pointerdown",e=>{a=!0,o=e.clientX,s=t.scrollLeft,r.setPointerCapture(e.pointerId),e.preventDefault()}),r.addEventListener("pointermove",e=>{if(!a)return;let l=e.clientX-o,n=t.scrollWidth,c=t.clientWidth,d=n-c,u=i.offsetWidth-r.offsetWidth,h=l/u*d;t.scrollLeft=s+h}),r.addEventListener("pointerup",e=>{a=!1,r.releasePointerCapture(e.pointerId)}),r.addEventListener("pointercancel",e=>{a=!1,r.releasePointerCapture(e.pointerId)}),i.addEventListener("click",e=>{if(e.target===r)return;let l=i.getBoundingClientRect(),n=e.clientX-l.left,a=t.scrollWidth,o=t.clientWidth,s=a-o,c=n/i.offsetWidth;t.scrollLeft=c*s}),n();let c=new ResizeObserver(n);c.observe(t)};document.addEventListener("dragstart",e=>{if("IMG"===e.target.tagName)return e.preventDefault(),!1});let g=(e=document)=>{let t=e.querySelectorAll("article.writing-post table");t.forEach(e=>{if(e.parentElement&&e.parentElement.classList.contains("table-wrapper"))return;let t=document.createElement("div");t.className="table-wrapper";let l=document.createElement("div");l.className="table-scroll",e.parentNode.insertBefore(t,e),l.appendChild(e),t.appendChild(l),f(t,l)})},b=(e=document)=>{let t=e.querySelectorAll("pre code");t.length>0&&m().then(()=>{t.forEach(e=>{"undefined"!=typeof hljs&&hljs.highlightElement(e)})}).catch(e=>{console.error("Syntax highlighting unavailable:",e)}),e.querySelectorAll(".code-block").forEach(e=>{let t=e.querySelector(".code-scroll");t&&!e.querySelector(".code-block__custom-scrollbar")&&f(e,t)});let l=e.querySelectorAll(".code-language-tag");l.forEach(e=>{if("true"===e.dataset.enhanced)return;let t=e.closest(".code-block"),l=t?t.querySelector("pre"):e.closest("pre"),i=l?l.querySelector("code"):null;if(!l||!i)return;let r=t||l,n=t?t.querySelector(".code-scroll"):null,a=()=>(!t||void 0===t._touchActive||!!t._touchActive)&&!!r&&r.matches(":hover"),o=(e=100)=>{if(t)t._hoverRemovalTimer&&(clearTimeout(t._hoverRemovalTimer),t._hoverRemovalTimer=null),!t.classList.contains("code-block--hover")&&(t._hoverAdditionTimer&&(clearTimeout(t._hoverAdditionTimer),t._hoverAdditionTimer=null),t._hoverAdditionTimer=setTimeout(()=>{t.classList.add("code-block--hover"),t._hoverAdditionTimer=null},e))},s=(e=900)=>{t&&(t._hoverAdditionTimer&&(clearTimeout(t._hoverAdditionTimer),t._hoverAdditionTimer=null),t._hoverRemovalTimer&&clearTimeout(t._hoverRemovalTimer),t._hoverRemovalTimer=setTimeout(()=>{if(t._hoverPointerActive||t._hoverFocusActive||a()){t._hoverRemovalTimer=null;return}t.classList.remove("code-block--hover"),t._hoverRemovalTimer=null},e))},c=e=>{t&&(t._hoverPointerActive=!!e,e&&o())},d=e=>{t&&(t._hoverFocusActive=!!e,e&&o())},u=()=>{e._labelAnimation&&(e._labelAnimation.fadeOutTimer&&clearTimeout(e._labelAnimation.fadeOutTimer),e._labelAnimation.fadeInTimer&&clearTimeout(e._labelAnimation.fadeInTimer),e._labelAnimation=null,e._pendingLabel=null,e.style.transition="",e.style.opacity="1")},h=(t,{immediate:l=!1}={})=>{let i=(t||"").toLowerCase();if(!i||!l&&(e._currentLabel===i||e._pendingLabel===i))return;let r=()=>{e.textContent=i,e._currentLabel=i,e._pendingLabel=null};if(l){u(),r(),e.style.transition="",e.style.opacity="1";return}u(),e._pendingLabel=i;e.style.transition="opacity 0.12s ease",e.style.opacity="0";let n=setTimeout(()=>{r(),e.style.transition="opacity 0.22s ease",e.style.opacity="1";let t=setTimeout(()=>{u()},220);e._labelAnimation={fadeOutTimer:n,fadeInTimer:t}},120);e._labelAnimation={fadeOutTimer:n,fadeInTimer:null}},p="copy",m=(e.textContent||"").trim().toLowerCase()||"code";e.dataset.originalLabel=m,e.dataset.enhanced="true",h(m,{immediate:!0}),e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("aria-label",`Copy ${m} to clipboard`);let f=()=>{e.dataset.state="",t&&t._hoverPointerActive?h(p):h(e.dataset.originalLabel)},g=()=>{"copied"!==e.dataset.state&&"error"!==e.dataset.state&&h(p)},b=()=>{e.dataset.state="error",h("error"),e.blur(),e._copyTimer&&clearTimeout(e._copyTimer),e._copyTimer=setTimeout(f,1500)},v=()=>{e.dataset.state="copied",h("copied!"),e.blur(),e._copyTimer&&clearTimeout(e._copyTimer),e._copyTimer=setTimeout(f,1500)},y=async e=>{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;let t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select();let l=!1;try{l=document.execCommand("copy")}finally{document.body.removeChild(t)}return l},E=async()=>{let e=i.innerText||i.textContent||"";if(!e){b();return}try{let t=await y(e);t?v():b()}catch(l){console.error("Unable to copy code block:",l),b()}},$=()=>{c(!0),g()},L=()=>{if(c(!1),"copied"===e.dataset.state||"error"===e.dataset.state){s(0);return}h(e.dataset.originalLabel),s(0)},A=()=>{t&&(t._touchActive=!0),c(!0),g()},C=()=>{t&&(t._touchActive=!1),c(!1),"copied"!==e.dataset.state&&"error"!==e.dataset.state&&h(e.dataset.originalLabel)};r&&(r.addEventListener("mouseenter",$),r.addEventListener("mouseleave",L),r.addEventListener("touchstart",A,{passive:!0}),r.addEventListener("touchend",C),r.addEventListener("touchcancel",C)),n&&n.addEventListener("scroll",()=>{if(o(0),t&&t._scrollEndTimer&&clearTimeout(t._scrollEndTimer),t&&t._touchActive)return;let e=a();e?(c(!0),g()):!(t&&t._hoverFocusActive)&&t&&(t._scrollEndTimer=setTimeout(()=>{s(300),t._scrollEndTimer=null},150))},{passive:!0}),e.addEventListener("focus",()=>{d(!0),g()}),e.addEventListener("blur",()=>{if(d(!1),t&&t._hoverPointerActive)g();else{if("copied"===e.dataset.state||"error"===e.dataset.state){s(0);return}h(e.dataset.originalLabel),s(0)}}),e.addEventListener("click",e=>{e.preventDefault(),d(!0),g(),E()}),e.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),d(!0),g(),E())})})},v=e=>(e||"").toLowerCase().trim().replace(/["'`~!@#$%^&*()=+\[\]{}|;:\\<>,.?/]+/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),y=(e,t)=>{if(!e)return null;let l=(e.getAttribute("id")||"").trim();if(l)return l;let i=t||"section",r=2;for(;document.getElementById(i);)i=`${t||"section"}-${r++}`;return e.setAttribute("id",i),i},E=(e,t)=>{let l=e.querySelector("[data-toc]");if(!l)return;let i=[],r=document.querySelector(".container > h1"),n=r?y(r,"introduction"):null;if(n&&i.push({level:1,id:n,label:"Introduction"}),t.forEach(e=>{let t=parseInt((e.tagName||"").slice(1),10);if(!e.id||Number.isNaN(t)||t<2||t>3)return;let l=e.dataset.headingLabel;l||(l=(e.textContent||"").trim().replace(/^#\s*/,""),e.dataset.headingLabel=l),i.push({level:t,id:e.id,label:l})}),!i.length){l.innerHTML="",l.classList.add("is-empty");return}l.classList.remove("is-empty"),l.innerHTML="";let a=document.createElement("ol");a.className="writing-toc__list",l.appendChild(a);let o=null;i.forEach(e=>{if(1===e.level){let t=document.createElement("li");t.className="writing-toc__item writing-toc__item--level-1";let l=document.createElement("a");l.href=`#${e.id}`,l.textContent=e.label,t.appendChild(l),a.appendChild(t),o=null;return}if(2===e.level){let i=document.createElement("li");i.className="writing-toc__item writing-toc__item--level-2";let r=document.createElement("a");r.href=`#${e.id}`,r.textContent=e.label,i.appendChild(r),a.appendChild(i),o=i;return}if(3===e.level){if(!o){let n=document.createElement("li");n.className="writing-toc__item writing-toc__item--level-2";let s=document.createElement("a");s.href=`#${e.id}`,s.textContent=e.label,n.appendChild(s),a.appendChild(n),o=n;return}let c=o.querySelector("ol");c||((c=document.createElement("ol")).className="writing-toc__sublist",o.appendChild(c));let d=document.createElement("li");d.className="writing-toc__item writing-toc__item--level-3";let u=document.createElement("a");u.href=`#${e.id}`,u.textContent=e.label,d.appendChild(u),c.appendChild(d)}})},$=(e=document)=>{let t=e.querySelector(".writing-post__rail-right");if(!t)return;let l=e.querySelector(".writing-post__content");if(!l)return;let i=t.querySelector(".sidenote--rail");if(i&&"none"===window.getComputedStyle(i).display)return;let r=Array.from(l.querySelectorAll("label.sidenote-number"));if(!r.length)return;let n=l.getBoundingClientRect();t.getBoundingClientRect();let a=[];r.forEach(e=>{let l=e.getAttribute("for");if(!l)return;let i=t.querySelector(`.sidenote--rail[data-sidenote-ref="${l}"]`);if(!i)return;let r=e.parentElement,o=r.getBoundingClientRect(),s=window.getComputedStyle(r),c=parseFloat(s.lineHeight),d=e.getBoundingClientRect(),u=d.top-o.top,h=Math.round(u/c),p=h*c,m=o.top-n.top+p;a.push({sidenote:i,idealTop:m,height:0})}),a.forEach((e,t)=>{e.sidenote.style.top=`${e.idealTop}px`,e.height=e.sidenote.getBoundingClientRect().height;let l=window.getComputedStyle(e.sidenote),i=parseFloat(l.lineHeight),r=.5*i;for(let n=0;n<t;n++){let o=a[n],s=parseFloat(o.sidenote.style.top)+o.height,c=parseFloat(e.sidenote.style.top);c<s+r&&(e.sidenote.style.top=`${s+r}px`,e.idealTop=s+i)}})},L,A=()=>{clearTimeout(L),L=setTimeout(()=>{$(document)},10)};window.addEventListener("resize",A);let C=(e=document)=>{let t=e.querySelectorAll("h2, h3");if(!t.length){E(e,t);return}let l=new Set(Array.from(document.querySelectorAll("[id]")).map(e=>e.id));t.forEach(e=>{let t=e.dataset.headingLabel;if(t||(t=(e.textContent||"section").trim().replace(/^#\s*/,""),e.dataset.headingLabel=t),"true"===e.dataset.headingEnhanced)return;let i=(e.getAttribute("id")||"").trim(),r=i;if(!r){let n=v(t)||"section",a=n,o=2;for(;l.has(a);)a=`${n}-${o++}`;r=a,e.setAttribute("id",r),l.add(r)}let s=e.querySelector(".heading-anchor");if(!s){(s=document.createElement("a")).className="heading-anchor",s.href=`#${r}`,s.setAttribute("aria-label",`Link to section: ${t}`),s.textContent="#";let c=[],d=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),u;for(;u=d.nextNode();)u.textContent.trim()&&c.push(u);if(c.length>0){let h=c[c.length-1],p=h.textContent,m=p.trimEnd(),f=p.slice(m.length),g=m.lastIndexOf(" "),b=m.slice(0,g+1),y=m.slice(g+1);if(y){let E=document.createElement("span");E.style.whiteSpace="nowrap",E.textContent=y,E.appendChild(s),h.textContent=b+f,h.parentNode.insertBefore(E,h.nextSibling)}else e.appendChild(s)}else e.appendChild(s)}e.dataset.headingEnhanced="true"}),E(e,t),$(e)},_=(e,{animate:t=!0}={})=>{if(!e)return!1;let l=document.getElementById(e);return!!l&&(l.scrollIntoView({behavior:t?"smooth":"auto",block:"start",inline:"nearest"}),!0)},T=null,S=!1,w=e=>{if(T!==e){if(T&&T.removeAttribute("data-selection-active"),!(T=e||null)){document.body.removeAttribute("data-selection-lock");return}T.setAttribute("data-selection-active","true"),document.body.setAttribute("data-selection-lock","true")}},x=()=>{T&&(T.removeAttribute("data-selection-active"),T=null),document.body.removeAttribute("data-selection-lock"),S=!1},k=e=>{if(!e||!(e instanceof Node)||(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),!e||!(e instanceof Element)))return null;let t=e.closest(".sidenote");if(t)return t;let l=e.closest("table");if(l)return l;let i=e.closest(".writing-post__content");return i||null};document.addEventListener("pointerdown",e=>{let t=k(e.target);t?(w(t),S=!0):x()},{capture:!0});let q=()=>{if(S=!1,!document.getSelection){x();return}let e=document.getSelection();(!e||e.isCollapsed)&&x()};document.addEventListener("pointerup",q),document.addEventListener("pointercancel",x),window.addEventListener("blur",x),document.addEventListener("selectionchange",()=>{let e=document.getSelection?document.getSelection():null;if(!e||e.isCollapsed||0===e.rangeCount){S||x();return}let t=k(e.anchorNode)||k(e.focusNode);t?w(t):S||x()});let W=e=>{if(!e)return"/";let t=e.split("?")[0].split("#")[0];return t.startsWith("/")||(t=`/${t}`),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t||"/"},N=e=>{let t=W(e);if(d[t])return d[t];if(t.startsWith("/writing/")&&t.length>9){let l=t.slice(9);if(!l)return null;let i=l.replace(/\/+/g,"").replace(/\.html$/i,"");return i?{fragment:`_content/writing/${i}.html`,documentTitle:null,canonicalPath:`/writing/${i}`}:null}return null},I=(e,t)=>{if(i&&(i.textContent=e||c.title,i.classList.add("loaded")),r){let l=[];l=void 0===t?[c.subtitle]:Array.isArray(t)?t.filter(e=>e):t?[t]:[c.subtitle],r.textContent=l[0]||c.subtitle;let n=0;for(;r.hasAttribute(`data-subtitle-${n}`);)r.removeAttribute(`data-subtitle-${n}`),n++;l.forEach((e,t)=>{r.setAttribute(`data-subtitle-${t}`,e)});let a=document.querySelector(".subtitle");a&&a.classList.add("loaded")}let o=document.querySelector("footer");o&&o.classList.add("loaded")},R=l=>{let i=e.querySelector("[data-page-title]");if(i){let r=(i.getAttribute("data-page-title")||"").trim(),n=[],o=0;for(;i.hasAttribute(`data-page-subtitle-${o}`);){let s=(i.getAttribute(`data-page-subtitle-${o}`)||"").trim();s&&n.push(s),o++}if(0===n.length){let d=(i.getAttribute("data-page-subtitle")||"").trim();d&&n.push(d)}I(r||c.title,n.length>0?n:c.subtitle),!l.documentTitle&&r&&(document.title=`${r} - ${t}`),a();return}if(l&&l.heading){let{title:u,subtitle:h}=l.heading;I(u,h),a();return}I(c.title,c.subtitle),a()},B=e=>{let t=W(e),i=t.startsWith("/writing/")?"/writing":t;l.forEach(e=>{let t=W(e.getAttribute("href"));t===i?e.classList.add("active"):e.classList.remove("active")})},P=async(l,i=!0)=>{let r=W(l),n=N(r);if(!n||!n.fragment)return console.error(`No route found for path: ${r}`),e.innerHTML="<p>Page not found.</p>",document.title=`Not Found - ${t}`,I(c.title,c.subtitle),null;let a=n.canonicalPath||r,o=n.fragment.startsWith("/")?n.fragment:`/${n.fragment}`;try{let s=await fetch(o);if(!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let d=await s.text();return e.style.opacity="0",await u(150),e.innerHTML=d,x(),g(e),b(e),C(e),R(n),n.documentTitle&&(document.title=n.documentTitle),B(a),i&&(history.pushState({path:a,hash:null},document.title,a),window.scrollTo(0,0)),D=a,e.style.opacity="1",a}catch(h){return console.error("Error loading content:",h),e.innerHTML=`<p>Error loading page: ${h.message}</p>`,document.title=`Error - ${t}`,I(c.title,c.subtitle),e.style.opacity="1",null}};l.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();let l=e.getAttribute("href"),i=W(l);i!==W(window.location.pathname)&&P(i)})});let D=null,H=()=>W(window.location.pathname);e.addEventListener("click",e=>{let t=e.target.closest("a");if(!t||t.target&&"_self"!==t.target||t.hasAttribute("download")||"external"===t.getAttribute("rel"))return;let l=t.getAttribute("href");if(!l)return;if(l.startsWith("#")){let i=l.slice(1);if(!i)return;e.preventDefault();let r=H();history.pushState({path:r,hash:i},document.title,`${window.location.pathname}#${i}`),_(i,{animate:!0});return}let n=new URL(t.href,window.location.origin);if(n.origin!==window.location.origin)return;let a=W(n.pathname),o=N(a);if(!o)return;e.preventDefault();let s=n.hash?n.hash.slice(1):null;P(a).then(e=>{if(s){let t=e||a;history.replaceState({path:t,hash:s},document.title,`${t}#${s}`),_(s,{animate:!0})}})}),window.addEventListener("popstate",e=>{let t=e.state&&e.state.path?e.state.path:H(),l=e.state&&"string"==typeof e.state.hash?e.state.hash:window.location.hash?window.location.hash.slice(1):null;if(t===D){l?_(l,{animate:!0}):window.scrollTo({top:0,behavior:"smooth"});return}P(t,!1).then(()=>{l?requestAnimationFrame(()=>{_(l,{animate:!0})}):window.scrollTo({top:0,behavior:"smooth"})})}),window.addEventListener("hashchange",()=>{let e=window.location.hash?window.location.hash.slice(1):null;e?requestAnimationFrame(()=>{_(e,{animate:!0})}):window.scrollTo({top:0,behavior:"smooth"})});let j=W(window.location.pathname),F=N(j);if(!F){P("/",!1).then(()=>{history.replaceState({path:"/",hash:null},t,"/")});return}let M=window.location.hash?window.location.hash.slice(1):null;P(j,!1).then(e=>{let t=e||W(j);history.replaceState({path:t,hash:M},document.title,M?`${t}#${M}`:t),M&&requestAnimationFrame(()=>{_(M,{animate:!1})})})});
