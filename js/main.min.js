document.addEventListener("DOMContentLoaded",()=>{let c="David Wang";let d=1500,e={"/":{fragment:"_content/home.html",documentTitle:c},"/projects":{fragment:"_content/projects.html",documentTitle:"Projects - "+c},"/writing":{fragment:"_content/writing.html",documentTitle:"Writing - "+c},"/index.html":{fragment:"_content/home.html",documentTitle:c}},u=document.getElementById("content");if(!u)return;let h=Array.from(document.querySelectorAll(".subtitle .menu a.item")),i=document.querySelector(".container > h1"),r=document.querySelector(".subtitle > span:first-child"),a=r?.closest(".subtitle"),t=document.querySelector("footer");var n=(e,n)=>{let i;return(...t)=>{clearTimeout(i),i=setTimeout(()=>e(...t),n)}};let m=t=>{if(!t)return"/";let e=t.split("?")[0].split("#")[0];return(e=1<(e=e.startsWith("/")?e:"/"+e).length&&e.endsWith("/")?e.slice(0,-1):e)||"/"},p=t=>(t||"").toLowerCase().trim().replace(/["'`~!@#$%^&*()=+\[\]{}|;:\\<>,.?/]+/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),o=t=>{var e=parseFloat(t.lineHeight);return Number.isFinite(e)?e:(e=parseFloat(t.fontSize),Number.isFinite(e)?1.2*e:16)},g=async t=>{if(navigator.clipboard?.writeText)return await navigator.clipboard.writeText(t),!0;var e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style.cssText="position:absolute;left:-9999px",document.body.appendChild(e),e.select();try{return document.execCommand("copy")}finally{document.body.removeChild(e)}};var l=(t=>{if(!t)return[];var e,n=[];let i=0;for(;t.hasAttribute("data-subtitle-"+i);){var r=(t.getAttribute("data-subtitle-"+i)||"").trim();r&&n.push(r),i++}return n.length||(e=(t.textContent||"").trim())&&n.push(e),n})(r);let f={title:i?.textContent.trim()||c,subtitle:r?.textContent.trim()||"",subtitleVariants:l},s=()=>{var t;return 0<f.subtitleVariants.length?[...f.subtitleVariants]:(t=(f.subtitle||"").trim())?[t]:[]},v=t=>{var e;return Array.isArray(t)?(e=t.map(t=>(t||"").trim()).filter(Boolean)).length?e:s():"string"==typeof t&&(e=t.trim())?[e]:s()},b=(e,n)=>{if(i&&(i.textContent=e||f.title,i.classList.add("loaded")),r){e=v(n);r.textContent=e[0]||f.subtitle||"";let t=0;for(;r.hasAttribute("data-subtitle-"+t);)r.removeAttribute("data-subtitle-"+t++);e.forEach((t,e)=>{r.setAttribute("data-subtitle-"+e,t)}),a?.classList.add("loaded")}t?.classList.add("loaded")},y=null,w=t=>{if(!t)return null;y||((y=document.createElement("span")).id="menu-measure",y.style.cssText="visibility:hidden;position:absolute;white-space:nowrap",document.body.appendChild(y));t=window.getComputedStyle(t);return y.style.fontSize=t.fontSize,y.style.fontFamily=t.fontFamily,y.style.fontWeight=t.fontWeight,y.style.fontStretch=t.fontStretch,y},E=t=>{if(t){var n=t.closest(".subtitle")||t.closest("footer");if(n){var i=w(t);if(i){var r=n.offsetWidth,a=(i.textContent="0",i.offsetWidth),l=(t.classList.remove("menu--stacked"),t.offsetWidth,t.querySelectorAll(".item, a"));let e=0;l.forEach(t=>e+=t.offsetWidth);var o=e+a*(l.length-1),s=n.classList.contains("subtitle")?n:null,d=s?.querySelector("span:first-child"),c=[];if(d){let t=0;for(;d.hasAttribute("data-subtitle-"+t);)c.push(d.getAttribute("data-subtitle-"+t++))}if(r<o)d&&0<c.length&&(d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")),t.classList.add("menu--stacked");else if(s&&d&&0<c.length){var u,h=4*a;for(u of c)if(i.textContent=u,i.offsetWidth+h+o<=r)return d.textContent=u,void s.classList.remove("subtitle--stacked");d.textContent=c[c.length-1],s.classList.add("subtitle--stacked")}}}}},L=()=>{document.querySelectorAll(".menu").forEach(E)};l=n(L,10);L(),window.addEventListener("resize",l);let C=150,D=(d,c,u)=>{if(d&&c){let r=document.createElement("div"),a=(r.className="code-block__custom-scrollbar",r.innerHTML=`
            <div class="code-block__scrollbar-track">
                <div class="code-block__scrollbar-thumb"></div>
            </div>
        `,d.appendChild(r),r.querySelector(".code-block__scrollbar-track")),l=r.querySelector(".code-block__scrollbar-thumb");var h=()=>{var t,{scrollWidth:e,clientWidth:n,scrollLeft:i}=c;e<=n?r.style.display="none":(r.style.display="",t=n/e*a.offsetWidth,i=i/(e-n)*(a.offsetWidth-t),l.style.width=t+"px",l.style.left=i+"px")};c.addEventListener("scroll",h,{passive:!0}),h(),new ResizeObserver(h).observe(c);let i={hover:!1,touch:!1,scroll:!1,drag:!1},t=null,e=()=>{var t=i.hover||i.touch||i.scroll||i.drag;d.classList.toggle("code-block--scrollbar-visible",t)};d.addEventListener("mouseenter",()=>{i.hover=!0,e()}),d.addEventListener("mouseleave",()=>{i.hover=!1,e()}),d.addEventListener("touchstart",t=>{u&&(t.target===u||u.contains(t.target))||(i.touch=!0,e())},{passive:!0});h=()=>{i.touch=!1,e()};d.addEventListener("touchend",h),d.addEventListener("touchcancel",h),c.addEventListener("scroll",()=>{i.scroll=!0,e(),clearTimeout(t),t=setTimeout(()=>{i.scroll=!1,e()},C)},{passive:!0});let n=null;l.addEventListener("pointerdown",t=>{i.drag=!0,n=t.pointerId,l.setPointerCapture(t.pointerId),e(),t.preventDefault()});h=t=>{t.pointerId===n&&(i.drag=!1,n=null,l.releasePointerCapture(t.pointerId),e())};l.addEventListener("pointerup",h),l.addEventListener("pointercancel",h);let o=0,s=0;l.addEventListener("pointerdown",t=>{o=t.clientX,s=c.scrollLeft}),l.addEventListener("pointermove",t=>{var e,n;i.drag&&(t=t.clientX-o,e=c.scrollWidth-c.clientWidth,n=a.offsetWidth-l.offsetWidth,c.scrollLeft=s+t/n*e)}),a.addEventListener("click",t=>{var e;t.target!==l&&(e=a.getBoundingClientRect(),t=(t.clientX-e.left)/a.offsetWidth,c.scrollLeft=t*(c.scrollWidth-c.clientWidth))})}},H=(o,s)=>{if("true"!==o.dataset.copyEnabled){o.dataset.copyEnabled="true",o.tabIndex=o.tabIndex??0,o.setAttribute("role","button");let e=(o.textContent||"code").trim().toLowerCase(),n=(o.dataset.originalLabel=e,null),i=null,r=(t,e=!1)=>{let n=(t||"").toLowerCase();n&&o.textContent.toLowerCase()!==n&&(clearTimeout(i),e?(o.textContent=n,o.style.transition="",o.style.opacity="1"):(o.style.transition="opacity 0.12s ease",o.style.opacity="0",i=setTimeout(()=>{o.textContent=n,o.style.transition="opacity 0.22s ease",o.style.opacity="1"},120)))},a=t=>{clearTimeout(n),o.dataset.state=t?"copied":"error",r(t?"copied!":"error"),n=setTimeout(()=>{o.dataset.state="",r(e)},d)},l=async()=>{var t=s.innerText||s.textContent||"";if(t)try{a(await g(t))}catch(t){console.error("Copy failed:",t),a(!1)}else a(!1)};o.addEventListener("click",t=>{t.preventDefault(),l()}),o.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),l())})}},M=(t,e)=>{if(!t)return null;var n=(t.getAttribute("id")||"").trim();if(n)return n;let i=e||"section",r=2;for(;document.getElementById(i);)i=`${e||"section"}-`+r++;return t.setAttribute("id",i),i},S=(t,e)=>{t=t.querySelector("[data-toc]");if(t){let a=[];var n=i?M(i,"introduction"):null;if(n&&a.push({level:1,id:n,label:"Introduction"}),e.forEach(e=>{var n=parseInt((e.tagName||"").slice(1),10);if(!(!e.id||isNaN(n)||n<2||3<n)){let t=e.dataset.headingLabel;t||(t=(e.textContent||"").trim().replace(/^#\s*/,""),e.dataset.headingLabel=t),a.push({level:n,id:e.id,label:t})}}),a.length){t.classList.remove("is-empty");let i=document.createElement("ol"),r=(i.className="writing-toc__list",t.innerHTML="",t.appendChild(i),null);a.forEach(t=>{var e=document.createElement("li"),n=(e.className="writing-toc__item writing-toc__item--level-"+t.level,document.createElement("a"));if(n.href="#"+t.id,n.textContent=t.label,e.appendChild(n),t.level<=2)i.appendChild(e),r=2===t.level?e:null;else if(3===t.level)if(r){let t=r.querySelector("ol");t||((t=document.createElement("ol")).className="writing-toc__sublist",r.appendChild(t)),t.appendChild(e)}else i.appendChild(e),r=e})}else t.innerHTML="",t.classList.add("is-empty")}},A=(t=document)=>{let l=t.querySelector(".writing-post__rail-right");t=t.querySelector(".writing-post__content");if(l&&t){var e=l.querySelector(".sidenote--rail");if(!e||"none"!==window.getComputedStyle(e).display){e=Array.from(t.querySelectorAll("label.sidenote-number"));if(e.length){let r=t.getBoundingClientRect(),a=[];e.forEach(t=>{var e,n,i=t.getAttribute("for");i&&(i=l.querySelector(`.sidenote--rail[data-sidenote-ref="${i}"]`))&&(e=t.parentElement)&&(n=e.getBoundingClientRect(),e=window.getComputedStyle(e),e=o(e),t=t.getBoundingClientRect(),t=Math.round((t.top-n.top)/e),n=n.top-r.top+t*e,a.push({sidenote:i,idealTop:n,height:0}))}),a.forEach((e,n)=>{e.sidenote.style.top=e.idealTop+"px",e.height=e.sidenote.getBoundingClientRect().height;var t=window.getComputedStyle(e.sidenote),i=.5*o(t);for(let t=0;t<n;t++){var r=a[t],r=(parseFloat(r.sidenote.style.top)||0)+r.height;(parseFloat(e.sidenote.style.top)||0)<r+i&&(e.sidenote.style.top=(r=r+i)+"px",e.idealTop=r)}})}}}};l=n(()=>A(document),10);window.addEventListener("resize",l);let x=null,T=!1,_=t=>t&&t instanceof Node&&(t=t.nodeType===Node.TEXT_NODE?t.parentNode:t)&&t instanceof Element&&(t.closest(".sidenote")||t.closest(".math-display")||t.closest("table")||t.closest(".writing-post__content"))||null,W=t=>{x!==t&&(x?.removeAttribute("data-selection-active"),(x=t||null)?(x.setAttribute("data-selection-active","true"),document.body.setAttribute("data-selection-lock","true")):document.body.removeAttribute("data-selection-lock"))},q=()=>{x?.removeAttribute("data-selection-active"),x=null,document.body.removeAttribute("data-selection-lock"),T=!1},k=(document.addEventListener("pointerdown",t=>{t=_(t.target);t?(W(t),T=!0):q()},{capture:!0}),document.addEventListener("pointerup",()=>{T=!1;var t=document.getSelection?.();t&&!t.isCollapsed||q()}),document.addEventListener("pointercancel",q),window.addEventListener("blur",q),document.addEventListener("selectionchange",()=>{var t=document.getSelection?.();t&&!t.isCollapsed&&0!==t.rangeCount&&(t=_(t.anchorNode)||_(t.focusNode))?W(t):T||q()}),document.addEventListener("dragstart",t=>{if("IMG"===t.target.tagName)return t.preventDefault(),!1}),null),N=t=>{t=m(t);if(e[t])return e[t];if(t.startsWith("/writing/")&&t.length>"/writing/".length){t=t.slice("/writing/".length).replace(/\/+/g,"").replace(/\.html$/i,"");if(t)return{fragment:`_content/writing/${t}.html`,documentTitle:null,canonicalPath:"/writing/"+t}}return null},I=(t,e=!0)=>!!t&&!!(t=document.getElementById(t))&&(t.scrollIntoView({behavior:e?"smooth":"auto",block:"start",inline:"nearest"}),!0),F=async(e,n=!0)=>{var e=m(e),t=N(e);if(!t?.fragment)return console.error("No route found for: "+e),u.innerHTML="<p>Page not found.</p>",document.title="Not Found - "+c,b(f.title,f.subtitleVariants),null;var i,r,a,l=t.canonicalPath||e,o=t.fragment.startsWith("/")?t.fragment:"/"+t.fragment;try{var s,d=await fetch(o);if(d.ok)return s=await d.text(),u.style.opacity="0",a=150,await new Promise(t=>setTimeout(t,a)),u.innerHTML=s,q(),[r=document]=[u],r.querySelectorAll(".writing-post table").forEach(t=>{var e,n;t.parentElement?.classList.contains("table-wrapper")||((e=document.createElement("div")).className="table-wrapper",(n=document.createElement("div")).className="table-scroll",t.parentNode.insertBefore(e,t),n.appendChild(t),e.appendChild(n))}),[i=document]=[u],i.querySelectorAll(".code-block").forEach(t=>{var e,n,i;"true"!==t.dataset.enhanced&&(t.dataset.enhanced="true",e=t.querySelector(".code-scroll"),n=t.querySelector(".code-language-tag"),i=t.querySelector("pre")?.querySelector("code"),e&&D(t,e,n),n)&&i&&H(n,i)}),((t=document)=>{var e=t.querySelectorAll("h2, h3");if(e.length){let h=new Set(Array.from(document.querySelectorAll("[id]")).map(t=>t.id));e.forEach(i=>{let r=i.dataset.headingLabel;if(r||(r=(i.textContent||"section").trim().replace(/^#\s*/,""),i.dataset.headingLabel=r),"true"!==i.dataset.headingEnhanced){let n=(i.getAttribute("id")||"").trim();if(!n){var a=p(r)||"section";let t=a,e=2;for(;h.has(t);)t=a+"-"+e++;n=t,i.setAttribute("id",n),h.add(n)}if(!i.querySelector(".heading-anchor")){for(var t,e,l,o,s,d=document.createElement("a"),c=(d.className="heading-anchor",d.href="#"+n,d.textContent="#",[]),u=document.createTreeWalker(i,NodeFilter.SHOW_TEXT);t=u.nextNode();)t.textContent.trim()&&c.push(t);0<c.length&&(s=(o=(e=c[c.length-1]).textContent.trimEnd()).lastIndexOf(" "),l=o.slice(0,s+1),o=o.slice(s+1))?((s=document.createElement("span")).style.whiteSpace="nowrap",s.textContent=o,s.appendChild(d),e.textContent=l,e.parentNode.insertBefore(s,e.nextSibling)):i.appendChild(d)}i.dataset.headingEnhanced="true"}}),S(t,e),A(t)}else S(t,e)})(u),(e=>{var n=u.querySelector("[data-page-title]");if(n){var i,r=(n.getAttribute("data-page-title")||"").trim(),a=[];let t=0;for(;n.hasAttribute("data-page-subtitle-"+t);){var l=(n.getAttribute("data-page-subtitle-"+t++)||"").trim();l&&a.push(l)}a.length||(i=(n.getAttribute("data-page-subtitle")||"").trim())&&a.push(i),b(r||f.title,a.length?a:f.subtitleVariants),!e.documentTitle&&r&&(document.title=r+" - "+c),void L()}else e?.heading?b(e.heading.title,e.heading.subtitle):b(f.title,f.subtitleVariants),L()})(t),t.documentTitle&&(document.title=t.documentTitle),(t=>{t=m(t);let n=t.startsWith("/writing/")?"/writing":t;h.forEach(t=>{var e=m(t.getAttribute("href"));t.classList.toggle("active",e===n)})})(l),n&&(history.pushState({path:l,hash:null},document.title,l),window.scrollTo(0,0)),k=l,u.style.opacity="1",l;throw new Error("HTTP "+d.status)}catch(t){return(console.error("Error loading content:",t),e.startsWith("/writing/")&&"/writing"!==e)?(console.log("Writing page not found, redirecting to /writing"),F("/writing",n)):(u.innerHTML=`<p>Error loading page: ${t.message}</p>`,document.title="Error - "+c,b(f.title,f.subtitleVariants),u.style.opacity="1",null)}},B=(h.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();t=m(e.getAttribute("href"));t!==m(window.location.pathname)&&F(t)})}),u.addEventListener("click",t=>{var e=t.target.closest("a");if(e&&!(e.target&&"_self"!==e.target||e.hasAttribute("download")||"external"===e.getAttribute("rel"))){var n=e.getAttribute("href");if(n)if(n.startsWith("#")){n=n.slice(1);n&&(t.preventDefault(),i=m(window.location.pathname),history.pushState({path:i,hash:n},document.title,window.location.pathname+"#"+n),I(n))}else{var i=new URL(e.href,window.location.origin);if(i.origin===window.location.origin){let n=m(i.pathname);if(N(n)){t.preventDefault();let e=i.hash?i.hash.slice(1):null;F(n).then(t=>{e&&(t=t||n,history.replaceState({path:t,hash:e},document.title,t+"#"+e),I(e))})}}}}}),window.addEventListener("popstate",t=>{var e=t.state?.path||m(window.location.pathname);let n=t.state?.hash||(window.location.hash?window.location.hash.slice(1):null);e===k?n?I(n):window.scrollTo({top:0,behavior:"smooth"}):F(e,!1).then(()=>{n?requestAnimationFrame(()=>I(n)):window.scrollTo({top:0,behavior:"smooth"})})}),window.addEventListener("hashchange",()=>{let t=window.location.hash?window.location.hash.slice(1):null;t?requestAnimationFrame(()=>I(t)):window.scrollTo({top:0,behavior:"smooth"})}),m(window.location.pathname));if(N(B)){let e=window.location.hash?window.location.hash.slice(1):null;F(B,!1).then(t=>{t=t||m(B);history.replaceState({path:t,hash:e},document.title,e?t+"#"+e:t),e&&requestAnimationFrame(()=>I(e,!1))})}else F("/",!1).then(()=>{history.replaceState({path:"/",hash:null},c,"/")})});